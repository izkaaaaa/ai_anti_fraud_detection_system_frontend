# ðŸŽ‰ å®žæ—¶ç›‘æµ‹åŠŸèƒ½å®žçŽ°å®Œæˆ

## ðŸ“‹ å®žçŽ°æ€»ç»“

æ ¹æ®åŽç«¯æä¾›çš„æŽ¥å£æ–‡æ¡£ `lib/materials/å‰ç«¯å¯¹æŽ¥æ–‡æ¡£-å®žæ—¶æ£€æµ‹æŽ¥å£.md`ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†**éŸ³é¢‘æµå’Œè§†é¢‘æµçš„å®žæ—¶ç›‘æµ‹åŠŸèƒ½**ã€‚

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. ä¿®æ”¹ `RealTimeDetectionService.dart`
**æ–‡ä»¶ä½ç½®ï¼š** `lib/services/RealTimeDetectionService.dart`

**ä¸»è¦æ”¹åŠ¨ï¼š**
- âœ… å®Œå–„ WebSocket æ¶ˆæ¯å¤„ç†é€»è¾‘ï¼Œå®Œå…¨ç¬¦åˆæŽ¥å£æ–‡æ¡£æ ¼å¼
- âœ… æ·»åŠ  `onControlMessage` å›žè°ƒå¤„ç†é˜²å¾¡å‡çº§
- âœ… æ·»åŠ  `onAckReceived` å›žè°ƒå¤„ç† ACK ç¡®è®¤
- âœ… ä¿®æ”¹è§†é¢‘å¸§å‘é€é¢‘çŽ‡ä¸ºæ¯ç§’ 1 å¸§ï¼ˆç¬¦åˆæ–‡æ¡£å»ºè®®ï¼‰
- âœ… ä¼˜åŒ–è§†é¢‘å¸§åŽ‹ç¼©è´¨é‡ä¸º 80%ï¼ˆæ–‡æ¡£å»ºè®® 0.7-0.9ï¼‰
- âœ… å®Œå–„æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºŽè°ƒè¯•

**å…³é”®ä»£ç ï¼š**
```dart
// å¤„ç†æ£€æµ‹ç»“æžœï¼ˆæŒ‰ç…§æ–‡æ¡£æ ¼å¼ï¼‰
case 'detection_result':
  final detectionType = data['detection_type'] ?? 'æœªçŸ¥';
  final isRisk = data['is_risk'] ?? false;
  final confidence = data['confidence'] ?? 0.0;
  final message = data['message'] ?? '';
  // ...

// å¤„ç†æŽ§åˆ¶æ¶ˆæ¯ï¼ˆé˜²å¾¡å‡çº§ï¼‰
case 'control':
  if (action == 'upgrade_level') {
    final targetLevel = data['target_level'] ?? 1;
    final reason = data['reason'] ?? '';
    final config = data['config'] ?? {};
    // ...
```

---

### 2. ä¿®æ”¹ `index.dart` (å¸¸é‡é…ç½®)
**æ–‡ä»¶ä½ç½®ï¼š** `lib/contants/index.dart`

**ä¸»è¦æ”¹åŠ¨ï¼š**
- âœ… æ·»åŠ  `CREATE_CALL_RECORD` æŽ¥å£åœ°å€
- âœ… æ·»åŠ  `getWebSocketUrl()` æ–¹æ³•åŠ¨æ€ç”Ÿæˆ WebSocket URL
- âœ… é›†ä¸­ç®¡ç†æ‰€æœ‰å®žæ—¶æ£€æµ‹ç›¸å…³çš„æŽ¥å£åœ°å€

**å…³é”®ä»£ç ï¼š**
```dart
class HttpConstants {
  static const String CREATE_CALL_RECORD = "/api/call-records/start";
  
  static String getWebSocketUrl(int userId, String callId, String token) {
    final wsBaseUrl = GlobalConstants.BASE_URL.replaceFirst('http://', 'ws://');
    return '$wsBaseUrl/api/detection/ws/$userId/$callId?token=$token';
  }
}
```

---

### 3. ä¿®æ”¹ `Detection/index.dart` (å®žæ—¶ç›‘æµ‹é¡µé¢)
**æ–‡ä»¶ä½ç½®ï¼š** `lib/pages/Detection/index.dart`

**ä¸»è¦æ”¹åŠ¨ï¼š**
- âœ… æ›´æ–° `onDetectionResult` å›žè°ƒï¼ŒæŒ‰ç…§æŽ¥å£æ–‡æ¡£æ ¼å¼è§£æžæ•°æ®
- âœ… æ·»åŠ  `onControlMessage` å›žè°ƒå¤„ç†é˜²å¾¡å‡çº§
- âœ… æ·»åŠ  `onAckReceived` å›žè°ƒï¼ˆå¯é€‰ï¼‰
- âœ… å®žçŽ° `_showFullScreenWarning()` å…¨å±è­¦å‘Šå¯¹è¯æ¡†
- âœ… æ£€æµ‹åˆ°é£Žé™©æ—¶è‡ªåŠ¨æ˜¾ç¤ºæç¤ºæ¶ˆæ¯

**å…³é”®ä»£ç ï¼š**
```dart
// æ£€æµ‹ç»“æžœå›žè°ƒ
_detectionService.onDetectionResult = (result) {
  final detectionType = result['detection_type'] ?? '';
  final isRisk = result['is_risk'] ?? false;
  final confidence = (result['confidence'] ?? 0.0).toDouble();
  
  if (detectionType == 'è¯­éŸ³') {
    _audioConfidence = confidence;
    _audioIsFake = isRisk;
  }
  // ...
};

// æŽ§åˆ¶æ¶ˆæ¯å›žè°ƒ
_detectionService.onControlMessage = (control) {
  if (control['action'] == 'upgrade_level') {
    _showFullScreenWarning(...);
  }
};
```

---

### 4. åˆ›å»ºä½¿ç”¨è¯´æ˜Žæ–‡æ¡£
**æ–‡ä»¶ä½ç½®ï¼š** `lib/materials/å®žæ—¶ç›‘æµ‹ä½¿ç”¨è¯´æ˜Ž.md`

**å†…å®¹åŒ…æ‹¬ï¼š**
- âœ… åŠŸèƒ½æ¸…å•
- âœ… ä½¿ç”¨æµç¨‹
- âœ… æ•°æ®æµè¯´æ˜Ž
- âœ… æŠ€æœ¯ç»†èŠ‚
- âœ… è°ƒè¯•æŠ€å·§
- âœ… å¸¸è§é—®é¢˜

---

## ðŸ”„ æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ App   â”‚                    â”‚  åŽç«¯æœåŠ¡å™¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                   â”‚
       â”‚ 1. åˆ›å»ºé€šè¯è®°å½•                    â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                                   â”‚
       â”‚ 2. å»ºç«‹ WebSocket è¿žæŽ¥             â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                                   â”‚
       â”‚ 3. æ¯3ç§’å‘é€éŸ³é¢‘æ•°æ®                â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ACK
       â”‚                                   â”‚
       â”‚ 4. æ¯1ç§’å‘é€è§†é¢‘å¸§                  â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ACK
       â”‚                                   â”‚
       â”‚                                   â”‚ AI åˆ†æžä¸­...
       â”‚                                   â”‚
       â”‚ 5. æŽ¥æ”¶æ£€æµ‹ç»“æžœ                     â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                   â”‚
       â”‚ 6. æŽ¥æ”¶é˜²å¾¡å‡çº§æŒ‡ä»¤                 â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                   â”‚
       â”‚ 7. æ˜¾ç¤ºè­¦å‘Š                        â”‚
       â”‚                                   â”‚
       â”‚ 8. æ¯30ç§’å‘é€å¿ƒè·³                   â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ å¿ƒè·³å“åº”
       â”‚                                   â”‚
```

---

## ðŸ“Š æŠ€æœ¯å‚æ•°

### éŸ³é¢‘ä¼ è¾“
| å‚æ•° | å€¼ |
|------|-----|
| æ ¼å¼ | AAC (ADTS) |
| é‡‡æ ·çŽ‡ | 44100 Hz |
| æ¯”ç‰¹çŽ‡ | 128 kbps |
| å‘é€é—´éš” | 3 ç§’ |
| ç¼–ç  | Base64 |
| é¢„è®¡å»¶è¿Ÿ | ~3 ç§’ |

### è§†é¢‘ä¼ è¾“
| å‚æ•° | å€¼ |
|------|-----|
| æ ¼å¼ | JPEG |
| åˆ†è¾¨çŽ‡ | 640x480 |
| è´¨é‡ | 80% |
| å‘é€é—´éš” | 1 ç§’ (1 FPS) |
| ç¼–ç  | Base64 |
| é¢„è®¡å»¶è¿Ÿ | ~14 ç§’ (ç§¯æ”’10å¸§+æŽ¨ç†) |

### WebSocket
| å‚æ•° | å€¼ |
|------|-----|
| åè®® | WebSocket |
| è®¤è¯ | JWT Token (Query å‚æ•°) |
| å¿ƒè·³é—´éš” | 30 ç§’ |
| é‡è¿žç­–ç•¥ | è‡ªåŠ¨é‡è¿ž |

---

## ðŸŽ¯ ä¸ŽæŽ¥å£æ–‡æ¡£çš„å¯¹åº”å…³ç³»

### âœ… å®Œå…¨å®žçŽ°çš„åŠŸèƒ½

| æ–‡æ¡£è¦æ±‚ | å®žçŽ°ä½ç½® | çŠ¶æ€ |
|---------|---------|------|
| WebSocket è¿žæŽ¥ | `_connectWebSocket()` | âœ… |
| å‘é€éŸ³é¢‘æ•°æ® | `_startAudioStreaming()` | âœ… |
| å‘é€è§†é¢‘å¸§ | `_startVideoFrameCapture()` | âœ… |
| å‘é€å¿ƒè·³ | `_startHeartbeat()` | âœ… |
| æŽ¥æ”¶ ACK | `case 'ack'` | âœ… |
| æŽ¥æ”¶æ£€æµ‹ç»“æžœ | `case 'detection_result'` | âœ… |
| æŽ¥æ”¶æŽ§åˆ¶æ¶ˆæ¯ | `case 'control'` | âœ… |
| é˜²å¾¡ç­‰çº§å‡çº§ | `_showFullScreenWarning()` | âœ… |

### â¸ï¸ æš‚æœªå®žçŽ°çš„åŠŸèƒ½

| åŠŸèƒ½ | åŽŸå›  | è®¡åˆ’ |
|------|------|------|
| æ–‡æœ¬æµä¼ è¾“ | æŒ‰ç”¨æˆ·è¦æ±‚æš‚æ—¶æç½® | åŽç»­å®žçŽ° |
| è¯­éŸ³è¯†åˆ« | éœ€è¦é›†æˆè¯­éŸ³è¯†åˆ« SDK | åŽç»­å®žçŽ° |

---

## ðŸ§ª æµ‹è¯•å»ºè®®

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] å¯åŠ¨ç›‘æµ‹ï¼Œæ£€æŸ¥ WebSocket æ˜¯å¦è¿žæŽ¥æˆåŠŸ
- [ ] è§‚å¯ŸéŸ³é¢‘æ³¢å½¢æ˜¯å¦å®žæ—¶è·³åŠ¨
- [ ] æŸ¥çœ‹æ—¥å¿—ç¡®è®¤éŸ³é¢‘/è§†é¢‘æ•°æ®æ˜¯å¦å‘é€
- [ ] æ£€æŸ¥æ˜¯å¦æ”¶åˆ° ACK ç¡®è®¤

### 2. æ£€æµ‹ç»“æžœæµ‹è¯•
- [ ] ç­‰å¾… 3 ç§’ï¼Œæ£€æŸ¥æ˜¯å¦æ”¶åˆ°éŸ³é¢‘æ£€æµ‹ç»“æžœ
- [ ] ç­‰å¾… 14 ç§’ï¼Œæ£€æŸ¥æ˜¯å¦æ”¶åˆ°è§†é¢‘æ£€æµ‹ç»“æžœ
- [ ] éªŒè¯æ£€æµ‹ç»“æžœæ˜¯å¦æ­£ç¡®æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š

### 3. é£Žé™©è­¦å‘Šæµ‹è¯•
- [ ] è§¦å‘é«˜é£Žé™©æ£€æµ‹ï¼ˆéœ€è¦åŽç«¯é…åˆï¼‰
- [ ] æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºå…¨å±è­¦å‘Šå¯¹è¯æ¡†
- [ ] æµ‹è¯•"åœæ­¢ç›‘æµ‹"å’Œ"ç»§ç»­ç›‘æµ‹"æŒ‰é’®

### 4. å¼‚å¸¸æƒ…å†µæµ‹è¯•
- [ ] æ–­å¼€ç½‘ç»œï¼Œæ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºé”™è¯¯
- [ ] æ‹’ç»æƒé™ï¼Œæ£€æŸ¥æ˜¯å¦æ­£ç¡®æç¤º
- [ ] åŽç«¯æœåŠ¡åœæ­¢ï¼Œæ£€æŸ¥æ˜¯å¦è‡ªåŠ¨é‡è¿ž

---

## ðŸš€ å¦‚ä½•è¿è¡Œ

### 1. å¯åŠ¨åŽç«¯
```bash
cd E:\wangtiao\AI-Anti-Fraud-Detection-System-API
python main.py
```

### 2. é…ç½®å‰ç«¯
ç¼–è¾‘ `lib/contants/index.dart`ï¼š
```dart
// æ¨¡æ‹Ÿå™¨
static const DeviceMode CURRENT_MODE = DeviceMode.emulator;

// çœŸæœº
static const DeviceMode CURRENT_MODE = DeviceMode.realDevice;
```

### 3. è¿è¡Œ App
```bash
flutter run
```

### 4. æµ‹è¯•
1. ç™»å½•è´¦å·
2. è¿›å…¥"å®žæ—¶ç›‘æµ‹"é¡µé¢
3. ç‚¹å‡»"å¼€å§‹ç›‘æµ‹"
4. æŽˆäºˆæƒé™
5. è§‚å¯Ÿæ£€æµ‹ç»“æžœ

---

## ðŸ“ ä»£ç å˜æ›´æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
1. `lib/services/RealTimeDetectionService.dart` - æ ¸å¿ƒæœåŠ¡ç±»
2. `lib/contants/index.dart` - å¸¸é‡é…ç½®
3. `lib/pages/Detection/index.dart` - å®žæ—¶ç›‘æµ‹é¡µé¢

### æ–°å¢žçš„æ–‡ä»¶
1. `lib/materials/å®žæ—¶ç›‘æµ‹ä½¿ç”¨è¯´æ˜Ž.md` - ä½¿ç”¨æ–‡æ¡£
2. `REALTIME_DETECTION_IMPLEMENTATION.md` - å®žçŽ°æ€»ç»“ï¼ˆæœ¬æ–‡ä»¶ï¼‰

### æœªä¿®æ”¹çš„æ–‡ä»¶
- å…¶ä»–é¡µé¢å’ŒæœåŠ¡ä¿æŒä¸å˜
- ä¸å½±å“çŽ°æœ‰åŠŸèƒ½

---

## ðŸŽ“ æŠ€æœ¯äº®ç‚¹

### 1. å®Œå…¨ç¬¦åˆæŽ¥å£æ–‡æ¡£
- ä¸¥æ ¼æŒ‰ç…§åŽç«¯æä¾›çš„æŽ¥å£æ–‡æ¡£å®žçŽ°
- æ¶ˆæ¯æ ¼å¼ã€å­—æ®µåç§°å®Œå…¨ä¸€è‡´
- æ”¯æŒæ‰€æœ‰æ–‡æ¡£å®šä¹‰çš„æ¶ˆæ¯ç±»åž‹

### 2. å®žæ—¶æ€§èƒ½ä¼˜åŒ–
- éŸ³é¢‘æ¯ 3 ç§’å‘é€ï¼Œå¹³è¡¡å®žæ—¶æ€§å’Œæ€§èƒ½
- è§†é¢‘æ¯ç§’ 1 å¸§ï¼Œå‡å°‘å¸¦å®½å ç”¨
- è‡ªåŠ¨åŽ‹ç¼©å’Œç¼–ç ï¼Œé™ä½Žä¼ è¾“æ•°æ®é‡

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- å®žæ—¶éŸ³é¢‘æ³¢å½¢æ˜¾ç¤º
- æ£€æµ‹ç»“æžœå®žæ—¶æ›´æ–°
- é£Žé™©è­¦å‘Šè‡ªåŠ¨å¼¹å‡º
- å…¨å±è­¦å‘Šå¯¹è¯æ¡†é†’ç›®

### 4. é”™è¯¯å¤„ç†å®Œå–„
- WebSocket æ–­çº¿è‡ªåŠ¨é‡è¿ž
- æƒé™æ£€æŸ¥å’Œå¼•å¯¼
- è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- å‹å¥½çš„é”™è¯¯æç¤º

---

## ðŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸä¼˜åŒ–
1. æ·»åŠ æ–‡æœ¬æµä¼ è¾“ï¼ˆè¯­éŸ³è¯†åˆ«ç»“æžœï¼‰
2. ä¼˜åŒ–å†…å­˜å ç”¨
3. æ·»åŠ ç½‘ç»œçŠ¶æ€ç›‘æµ‹
4. æ”¯æŒåŽå°è¿è¡Œ

### é•¿æœŸä¼˜åŒ–
1. æ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼
2. è‡ªé€‚åº”è§†é¢‘è´¨é‡
3. ç¦»çº¿ç¼“å­˜æœºåˆ¶
4. æ£€æµ‹åŽ†å²å›žæ”¾

---

## ðŸ“ž è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- **å‰ç«¯ä»£ç ï¼š** `lib/services/RealTimeDetectionService.dart`
- **æŽ¥å£æ–‡æ¡£ï¼š** `lib/materials/å‰ç«¯å¯¹æŽ¥æ–‡æ¡£-å®žæ—¶æ£€æµ‹æŽ¥å£.md`
- **ä½¿ç”¨è¯´æ˜Žï¼š** `lib/materials/å®žæ—¶ç›‘æµ‹ä½¿ç”¨è¯´æ˜Ž.md`
- **åŽç«¯é¡¹ç›®ï¼š** `E:\wangtiao\AI-Anti-Fraud-Detection-System-API`

---

**å®žçŽ°å®Œæˆæ—¶é—´ï¼š** 2026-02-23  
**å®žçŽ°è€…ï¼š** Claude (AI Assistant)  
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆå¹¶å¯æµ‹è¯•

