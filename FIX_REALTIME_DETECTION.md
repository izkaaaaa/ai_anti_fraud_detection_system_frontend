# ğŸ”§ å®æ—¶ç›‘æµ‹æœåŠ¡åœ°å€ä¿®å¤

## é—®é¢˜æè¿°

**ç—‡çŠ¶**ï¼šå®æ—¶ç›‘æµ‹ä¸€ç›´æ˜¾ç¤º"è¿æ¥ä¸­"ï¼Œæœ€ç»ˆè¶…æ—¶å¤±è´¥

**é”™è¯¯æ—¥å¿—**ï¼š
```
åˆ›å»ºé€šè¯è®°å½•å¤±è´¥: SocketException: Connection timed out
address = 8.138.115.75, port = 54202
```

**æ ¹æœ¬åŸå› **ï¼š
- ç™»å½•ç­‰åŠŸèƒ½ä½¿ç”¨ `DioRequest`ï¼Œåœ°å€æ˜¯ `http://172.20.16.1:8000` âœ…
- å®æ—¶ç›‘æµ‹ä½¿ç”¨ `HttpClient`ï¼Œåœ°å€æ˜¯ `http://8.138.115.75:8000` âŒ
- ä¸¤ä¸ªåœ°å€ä¸ä¸€è‡´ï¼Œå¯¼è‡´å®æ—¶ç›‘æµ‹æ— æ³•è¿æ¥

## ä¿®å¤å†…å®¹

### 1. ç»Ÿä¸€æœåŠ¡å™¨åœ°å€é…ç½®

**ä¿®æ”¹å‰**ï¼š
```dart
// RealTimeDetectionService.dart
static const String WS_BASE_URL = 'ws://8.138.115.75:8000';  // âŒ ç¡¬ç¼–ç é”™è¯¯åœ°å€
```

**ä¿®æ”¹å**ï¼š
```dart
// RealTimeDetectionService.dart
String get _wsBaseUrl {
  // åŠ¨æ€ä» GlobalConstants è·å–ï¼Œä¸ HTTP åœ°å€ä¿æŒä¸€è‡´
  return GlobalConstants.BASE_URL.replaceFirst('http://', 'ws://');
}
// ç»“æœï¼šws://172.20.16.1:8000 âœ…
```

### 2. ä½¿ç”¨ DioRequest æ›¿ä»£ HttpClient

**ä¿®æ”¹å‰**ï¼š
```dart
Future<String?> _createCallRecord() async {
  // ä½¿ç”¨åŸå§‹ HttpClientï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½® headers
  final response = await HttpClient().postUrl(
    Uri.parse('http://8.138.115.75:8000/api/call-records/start'),
  );
  response.headers.set('Authorization', 'Bearer $token');
  // ... å¤æ‚çš„å¤„ç†é€»è¾‘
}
```

**ä¿®æ”¹å**ï¼š
```dart
Future<String?> _createCallRecord() async {
  // ä½¿ç”¨ DioRequestï¼Œè‡ªåŠ¨å¤„ç† tokenã€è¶…æ—¶ã€é”™è¯¯
  final response = await dioRequest.post('/api/call-records/start');
  return response['id']?.toString();
}
```

### 3. æ”¹è¿›æ—¥å¿—è¾“å‡º

**æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—**ï¼š
```dart
print('ğŸ“ åˆ›å»ºé€šè¯è®°å½•...');
print('âœ… é€šè¯è®°å½•åˆ›å»ºæˆåŠŸ: ${response['id']}');
print('ğŸ”Œ è¿æ¥ WebSocket: $wsUrl');
print('âœ… WebSocket è¿æ¥æˆåŠŸ');
```

## ä¿®æ”¹çš„æ–‡ä»¶

### `lib/services/RealTimeDetectionService.dart`

**æ”¹åŠ¨ç‚¹**ï¼š
1. âœ… æ·»åŠ å¯¼å…¥ï¼š`import 'package:ai_anti_fraud_detection_system_frontend/utils/DioRequest.dart';`
2. âœ… æ·»åŠ å¯¼å…¥ï¼š`import 'package:ai_anti_fraud_detection_system_frontend/contants/index.dart';`
3. âœ… åˆ é™¤ï¼š`static const String WS_BASE_URL = 'ws://8.138.115.75:8000';`
4. âœ… æ·»åŠ ï¼š`String get _wsBaseUrl { return GlobalConstants.BASE_URL.replaceFirst('http://', 'ws://'); }`
5. âœ… é‡å†™ï¼š`_createCallRecord()` æ–¹æ³•ï¼Œä½¿ç”¨ `dioRequest`
6. âœ… é‡å†™ï¼š`_endCallRecord()` æ–¹æ³•ï¼Œä½¿ç”¨ `dioRequest`
7. âœ… æ›´æ–°ï¼š`_connectWebSocket()` æ–¹æ³•ï¼Œä½¿ç”¨ `_wsBaseUrl`
8. âœ… æ”¹è¿›ï¼šæ‰€æœ‰æ–¹æ³•çš„æ—¥å¿—è¾“å‡º

## ä¼˜åŠ¿

### ä¿®æ”¹å‰çš„é—®é¢˜
- âŒ åœ°å€ç¡¬ç¼–ç ï¼Œéš¾ä»¥ç»´æŠ¤
- âŒ ä½¿ç”¨ä¸¤å¥—ä¸åŒçš„ HTTP å®¢æˆ·ç«¯
- âŒ éœ€è¦æ‰‹åŠ¨å¤„ç† token
- âŒ æ²¡æœ‰ç»Ÿä¸€çš„è¶…æ—¶è®¾ç½®
- âŒ é”™è¯¯å¤„ç†ä¸ä¸€è‡´

### ä¿®æ”¹åçš„ä¼˜åŠ¿
- âœ… ç»Ÿä¸€ä» `GlobalConstants.BASE_URL` è·å–åœ°å€
- âœ… æ‰€æœ‰ HTTP è¯·æ±‚ä½¿ç”¨ `DioRequest`
- âœ… è‡ªåŠ¨æ·»åŠ  token åˆ°è¯·æ±‚å¤´
- âœ… ç»Ÿä¸€çš„è¶…æ—¶æ—¶é—´ï¼ˆ10ç§’ï¼‰
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- âœ… WebSocket åœ°å€è‡ªåŠ¨é€‚é… HTTP åœ°å€

## åœ°å€å¯¹ç…§è¡¨

| ç¯å¢ƒ | HTTP åœ°å€ | WebSocket åœ°å€ |
|------|----------|---------------|
| Android æ¨¡æ‹Ÿå™¨ | `http://172.20.16.1:8000` | `ws://172.20.16.1:8000` |
| iOS æ¨¡æ‹Ÿå™¨ | `http://172.20.16.1:8000` | `ws://172.20.16.1:8000` |
| Web | `http://localhost:8000` | `ws://localhost:8000` |

## æµ‹è¯•æ­¥éª¤

1. **é‡æ–°è¿è¡Œåº”ç”¨**
   ```bash
   flutter run
   ```

2. **ç™»å½•è´¦å·**

3. **è¿›å…¥å®æ—¶ç›‘æµ‹é¡µé¢**

4. **ç‚¹å‡»"å¼€å§‹ç›‘æµ‹"**

5. **æŸ¥çœ‹æ—¥å¿—è¾“å‡º**
   ```
   ğŸ“ åˆ›å»ºé€šè¯è®°å½•...
   âœ… é€šè¯è®°å½•åˆ›å»ºæˆåŠŸ: 123
   ğŸ”Œ è¿æ¥ WebSocket: ws://172.20.16.1:8000/ws/detection?token=xxx
   âœ… WebSocket è¿æ¥æˆåŠŸ
   ```

6. **éªŒè¯åŠŸèƒ½**
   - çŠ¶æ€åº”è¯¥ä»"è¿æ¥ä¸­"å˜ä¸º"ç›‘æµ‹ä¸­"
   - éŸ³é¢‘æ³¢å½¢åº”è¯¥å¼€å§‹åŠ¨ç”»
   - æ£€æµ‹ç»“æœåº”è¯¥å®æ—¶æ›´æ–°

## é¢„æœŸç»“æœ

### æˆåŠŸåœºæ™¯
```
ç”¨æˆ·ç‚¹å‡»"å¼€å§‹ç›‘æµ‹"
    â†“
æ£€æŸ¥æƒé™ âœ…
    â†“
çŠ¶æ€: å‡†å¤‡ä¸­ âœ…
    â†“
çŠ¶æ€: è¿æ¥ä¸­ âœ…
    â†“
åˆ›å»ºé€šè¯è®°å½• (http://172.20.16.1:8000) âœ…
    â†“
è¿æ¥ WebSocket (ws://172.20.16.1:8000) âœ…
    â†“
å¼€å§‹å½•éŸ³ âœ…
    â†“
çŠ¶æ€: ç›‘æµ‹ä¸­ âœ…
    â†“
å®æ—¶å‘é€éŸ³é¢‘æ•°æ® âœ…
    â†“
æ¥æ”¶æ£€æµ‹ç»“æœ âœ…
```

### å¦‚æœè¿˜æ˜¯å¤±è´¥

**æ£€æŸ¥åç«¯æœåŠ¡å™¨**ï¼š
```bash
# ç¡®è®¤åç«¯åœ¨ 172.20.16.1:8000 è¿è¡Œ
curl http://172.20.16.1:8000/api/health

# æ£€æŸ¥ WebSocket ç«¯ç‚¹
curl http://172.20.16.1:8000/ws/detection
```

**æ£€æŸ¥ç½‘ç»œè¿æ¥**ï¼š
```bash
# ä»æ¨¡æ‹Ÿå™¨ ping æœåŠ¡å™¨
adb shell ping 172.20.16.1
```

## æ³¨æ„äº‹é¡¹

1. **ç¡®ä¿åç«¯æœåŠ¡å™¨è¿è¡Œåœ¨ `172.20.16.1:8000`**
2. **ç¡®ä¿ WebSocket ç«¯ç‚¹ `/ws/detection` å·²å®ç°**
3. **ç¡®ä¿é˜²ç«å¢™å…è®¸ 8000 ç«¯å£**
4. **å¦‚æœæ›´æ¢ç½‘ç»œï¼Œéœ€è¦æ›´æ–° `DioRequest.dart` ä¸­çš„ IP åœ°å€**

## åç»­ä¼˜åŒ–å»ºè®®

1. **æ·»åŠ ç¯å¢ƒé…ç½®æ–‡ä»¶**
   - å¼€å‘ç¯å¢ƒï¼š`172.20.16.1:8000`
   - ç”Ÿäº§ç¯å¢ƒï¼š`https://api.example.com`

2. **æ·»åŠ å¥åº·æ£€æŸ¥**
   - å¯åŠ¨å‰æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯è¾¾
   - æ˜¾ç¤ºæœåŠ¡å™¨çŠ¶æ€æŒ‡ç¤ºå™¨

3. **æ·»åŠ é‡è¿æœºåˆ¶**
   - WebSocket æ–­å¼€è‡ªåŠ¨é‡è¿
   - æŒ‡æ•°é€€é¿ç­–ç•¥

4. **æ·»åŠ ç¦»çº¿æ¨¡å¼**
   - æœ¬åœ°ç¼“å­˜æ£€æµ‹ç»“æœ
   - ç½‘ç»œæ¢å¤ååŒæ­¥

